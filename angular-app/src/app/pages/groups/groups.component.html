<!-- Modern Groups Interface - Advanced Group Management System -->
<div class="groups-container">
  
  <!-- ======================================== -->
  <!-- HEADER SECTION -->
  <!-- ======================================== -->
  <div class="groups-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="groups-title">
          <i class="fas fa-users-class"></i>
          Groups
        </h1>
        <p class="groups-subtitle">Collaborate, share, and learn together</p>
      </div>
      
      <div class="header-actions">
        <!-- Search Bar -->
        <div class="search-container">
          <div class="search-input-group">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Search groups..."
              [(ngModel)]="searchTerm"
              (input)="searchGroups()"
              (keyup.enter)="searchGroups()">
            <button class="search-btn" (click)="searchGroups()">
              <i class="fas fa-search"></i>
            </button>
            <button 
              *ngIf="searchTerm" 
              class="clear-search-btn" 
              (click)="clearSearch()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <!-- Search Results Dropdown -->
          <div *ngIf="showSearchResults" class="search-results">
            <div *ngFor="let group of searchResults" 
                 class="search-result-item"
                 (click)="selectGroup(group); clearSearch()">
              <div class="result-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="result-content">
                <h4>{{ group.name }}</h4>
                <p>{{ group.description }}</p>
                <span class="result-meta">{{ group.memberCount }} members</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Create Group Button -->
        <button class="create-group-btn" (click)="openCreateGroupModal()">
          <i class="fas fa-plus"></i>
          Create Group
        </button>
      </div>
    </div>
  </div>

  <!-- ======================================== -->
  <!-- MAIN CONTENT AREA -->
  <!-- ======================================== -->
  <div class="groups-main">
    
    <!-- ======================================== -->
    <!-- GROUPS SIDEBAR -->
    <!-- ======================================== -->
    <div class="groups-sidebar">
      
      <!-- Groups List Header -->
      <div class="sidebar-header">
        <h3>
          <i class="fas fa-list"></i>
          Your Groups
        </h3>
        <span class="groups-count">{{ groups.length }}</span>
      </div>
      
      <!-- Groups List -->
      <div class="groups-list">
        
        <!-- Loading State -->
        <div *ngIf="isLoadingGroups" class="loading-state">
          <div class="spinner"></div>
          <p>Loading groups...</p>
        </div>
        
        <!-- Empty State -->
        <div *ngIf="!isLoadingGroups && groups.length === 0" class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-users-slash"></i>
          </div>
          <h4>No Groups Yet</h4>
          <p>Create your first group or join existing ones to start collaborating!</p>
          <button class="empty-action-btn" (click)="openCreateGroupModal()">
            <i class="fas fa-plus"></i>
            Create Group
          </button>
        </div>
        
        <!-- Groups Items -->
        <div *ngFor="let group of groups" 
             class="group-item"
             [class.active]="selectedGroup?.id === group.id"
             (click)="selectGroup(group)">
          
          <div class="group-avatar">
            <div class="avatar-circle" [class.archived]="group.archived">
              <i class="fas fa-users"></i>
            </div>
            <div *ngIf="group.archived" class="archived-badge">
              <i class="fas fa-archive"></i>
            </div>
          </div>
          
          <div class="group-info">
            <h4 class="group-name">{{ group.name }}</h4>
            <p class="group-description">{{ group.description || 'No description' }}</p>
            <div class="group-meta">
              <span class="member-count">
                <i class="fas fa-users"></i>
                {{ group.memberCount || 0 }}
              </span>
              <span class="group-subject" *ngIf="group.subject">
                <i class="fas fa-book"></i>
                {{ group.subject }}
              </span>
            </div>
          </div>
          
          <div class="group-actions">
            <button class="action-btn" 
                    (click)="$event.stopPropagation(); toggleGroupSettings()"
                    *ngIf="selectedGroup?.id === group.id">
              <i class="fas fa-cog"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- GROUP CHAT AREA -->
    <!-- ======================================== -->
    <div class="group-chat-area">
      
      <!-- No Group Selected State -->
      <div *ngIf="!selectedGroup" class="no-group-selected">
        <div class="welcome-content">
          <div class="welcome-icon">
            <i class="fas fa-comments"></i>
          </div>
          <h2>Welcome to Groups!</h2>
          <p>Select a group from the sidebar to start collaborating with your team.</p>
          <div class="welcome-features">
            <div class="feature-item">
              <i class="fas fa-message"></i>
              <span>Real-time messaging</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-file-upload"></i>
              <span>File sharing</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-users-cog"></i>
              <span>Member management</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-chart-bar"></i>
              <span>Group analytics</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Selected Group Chat -->
      <div *ngIf="selectedGroup" class="group-chat-container">
        
        <!-- Chat Header -->
        <div class="chat-header">
          <div class="chat-header-left">
            <div class="group-avatar-large">
              <i class="fas fa-users"></i>
            </div>
            <div class="group-info-large">
              <h3>{{ selectedGroup.name }}</h3>
              <p>{{ selectedGroup.description || 'No description available' }}</p>
              <div class="group-stats">
                <span class="stat-item">
                  <i class="fas fa-users"></i>
                  {{ selectedGroup.memberCount || 0 }} members
                </span>
                <span class="stat-item" *ngIf="selectedGroup.subject">
                  <i class="fas fa-book"></i>
                  {{ selectedGroup.subject }}
                </span>
                <span class="stat-item">
                  <i class="fas fa-calendar"></i>
                  Created {{ selectedGroup.createdDate | date:'MMM dd, yyyy' }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="chat-header-actions">
            <button class="header-action-btn" (click)="toggleMemberManagement()">
              <i class="fas fa-users-cog"></i>
              <span>Members</span>
            </button>
            <button class="header-action-btn" (click)="toggleGroupSettings()">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </button>
          </div>
        </div>

        <!-- Messages Area -->
        <div class="messages-container" #chatContainer>
          
          <!-- Loading Posts -->
          <div *ngIf="isLoadingPosts" class="posts-loading">
            <div class="spinner"></div>
            <p>Loading posts...</p>
          </div>
          
          <!-- Empty Posts State -->
          <div *ngIf="!isLoadingPosts && groupPosts.length === 0" class="no-posts">
            <div class="no-posts-icon">
              <i class="fas fa-comment-slash"></i>
            </div>
            <h4>No Posts Yet</h4>
            <p>Be the first to share something with the group!</p>
          </div>
          
          <!-- Posts List -->
          <div *ngFor="let post of groupPosts" class="post-item">
            <div class="post-avatar">
              <div class="avatar-circle">
                <i class="fas fa-user"></i>
              </div>
            </div>
            
            <div class="post-content">
              <div class="post-header">
                <span class="post-author">{{ getUserDisplayName(post.userId!) }}</span>
                <span class="post-time">{{ post.createdDate | date:'MMM dd, HH:mm' }}</span>
                <div *ngIf="hasAdminPrivileges() || post.userId === keycloakService.userId" 
                     class="post-actions">
                  <button class="post-action-btn" (click)="deletePost(selectedGroup!.id!, post.id!)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              
              <div class="post-body">
                <p *ngIf="post.type === 'TEXT'">{{ post.content }}</p>
                
                <!-- File Post -->
                <div *ngIf="post.type !== 'TEXT'" class="file-post">
                  <div class="file-icon">
                    <i class="fas fa-file" 
                       [class.fa-image]="post.type === 'IMAGE'"
                       [class.fa-video]="post.type === 'VIDEO'"
                       [class.fa-music]="post.type === 'AUDIO'"
                       [class.fa-file-alt]="post.type === 'DOCUMENT'"></i>
                  </div>
                  <div class="file-info">
                    <span class="file-name">{{ post.fileName }}</span>
                    <button class="download-btn" (click)="downloadFile(selectedGroup!.id!, post.id!)">
                      <i class="fas fa-download"></i>
                      Download
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Message Input Area -->
        <div class="message-input-area">
          <div class="input-container">
            
            <!-- File Upload -->
            <div class="input-actions-left">
              <label class="file-upload-btn" for="fileInput">
                <i class="fas fa-paperclip"></i>
                <input type="file" id="fileInput" (change)="onFileSelected($event)" style="display: none;">
              </label>
              
              <button class="emoji-btn" (click)="toggleEmojiPicker()">
                <i class="fas fa-smile"></i>
              </button>
            </div>
            
            <!-- Text Input -->
            <div class="text-input-container">
              <textarea 
                [(ngModel)]="newPostContent"
                placeholder="Share something with the group..."
                class="message-input"
                rows="1"
                (keydown.enter)="sendPost()"
                (keydown.shift.enter)="newPostContent += '\n'">
              </textarea>
            </div>
            
            <!-- Send Button -->
            <div class="input-actions-right">
              <button 
                class="send-btn" 
                (click)="sendPost()"
                [disabled]="!newPostContent.trim() || isSendingPost">
                <i *ngIf="!isSendingPost" class="fas fa-paper-plane"></i>
                <div *ngIf="isSendingPost" class="spinner-small"></div>
              </button>
            </div>
          </div>
          
          <!-- Upload Progress -->
          <div *ngIf="uploadProgress > 0" class="upload-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="uploadProgress"></div>
            </div>
            <span class="progress-text">{{ uploadProgress }}% uploaded</span>
          </div>
          
          <!-- Emoji Picker -->
          <div *ngIf="showEmojiPicker" class="emoji-picker-container">
            <emoji-mart (emojiSelect)="addEmoji($event)"></emoji-mart>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- MEMBER MANAGEMENT SIDEBAR -->
    <!-- ======================================== -->
    <div *ngIf="showMemberManagement && selectedGroup" class="member-management-sidebar">
      <div class="sidebar-header">
        <h3>
          <i class="fas fa-users-cog"></i>
          Members
        </h3>
        <button class="close-sidebar-btn" (click)="toggleMemberManagement()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="members-list">
        <div *ngFor="let member of groupMembers" class="member-item">
          <div class="member-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="member-info">
            <span class="member-name">{{ member.userId }}</span>
            <div class="member-roles">
              <span *ngIf="member.admin" class="role-badge admin">Admin</span>
              <span *ngIf="member.coAdmin" class="role-badge co-admin">Co-Admin</span>
              <span *ngIf="!member.admin && !member.coAdmin" class="role-badge member">Member</span>
            </div>
          </div>
          <div *ngIf="hasAdminPrivileges() && member.userId !== keycloakService.userId" 
               class="member-actions">
            <button class="member-action-btn" (click)="makeCoAdmin(selectedGroup!.id!, member.userId!)">
              <i class="fas fa-user-plus"></i>
            </button>
            <button class="member-action-btn danger" (click)="removeMemberFromGroup(selectedGroup!.id!, member.userId!)">
              <i class="fas fa-user-minus"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ======================================== -->
    <!-- GROUP SETTINGS SIDEBAR -->
    <!-- ======================================== -->
    <div *ngIf="showGroupSettings && selectedGroup" class="group-settings-sidebar">
      <div class="sidebar-header">
        <h3>
          <i class="fas fa-cog"></i>
          Group Settings
        </h3>
        <button class="close-sidebar-btn" (click)="toggleGroupSettings()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="settings-content">
        <div class="setting-section">
          <h4>Group Information</h4>
          <div class="setting-item">
            <label>Group Name</label>
            <input type="text" [value]="selectedGroup.name" class="setting-input">
          </div>
          <div class="setting-item">
            <label>Description</label>
            <textarea [value]="selectedGroup.description" class="setting-textarea"></textarea>
          </div>
          <div class="setting-item">
            <label>Subject</label>
            <input type="text" [value]="selectedGroup.subject" class="setting-input">
          </div>
        </div>
        
        <div class="setting-section">
          <h4>Actions</h4>
          <div class="setting-actions">
            <button class="setting-btn primary">
              <i class="fas fa-save"></i>
              Save Changes
            </button>
            <button class="setting-btn warning" (click)="archiveGroup(selectedGroup!.id!)">
              <i class="fas fa-archive"></i>
              Archive Group
            </button>
            <button class="setting-btn danger" (click)="deleteGroup(selectedGroup!.id!)">
              <i class="fas fa-trash"></i>
              Delete Group
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ======================================== -->
<!-- CREATE GROUP MODAL -->
<!-- ======================================== -->
<div *ngIf="showCreateGroupModal" class="modal-overlay" (click)="closeCreateGroupModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="fas fa-plus-circle"></i>
        Create New Group
      </h2>
      <button class="modal-close-btn" (click)="closeCreateGroupModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <form class="create-group-form">
        <div class="form-group">
          <label for="groupName">Group Name *</label>
          <input type="text" id="groupName" class="form-input" placeholder="Enter group name">
        </div>
        
        <div class="form-group">
          <label for="groupDescription">Description</label>
          <textarea id="groupDescription" class="form-textarea" placeholder="Describe your group"></textarea>
        </div>
        
        <div class="form-group">
          <label for="groupSubject">Subject</label>
          <input type="text" id="groupSubject" class="form-input" placeholder="e.g., Mathematics, Science, etc.">
        </div>
        
        <div class="form-actions">
          <button type="button" class="form-btn secondary" (click)="closeCreateGroupModal()">
            Cancel
          </button>
          <button type="submit" class="form-btn primary">
            <i class="fas fa-plus"></i>
            Create Group
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
